{% extends 'index.html' %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tickets.css') }}">
{% endblock %}

{% block body %}
<!-- Main Content -->
<div class="tickets-container">
    <!-- Header -->
    <div class="tickets-header">
        <div class="header-content">
            <h1>
                <i class="fas fa-ticket-alt"></i>
                Mis Tickets de Soporte
            </h1>
            <p>Gestiona todas tus solicitudes de soporte técnico</p>
        </div>
        <button class="btn-primary-lg" data-bs-toggle="modal" data-bs-target="#newTicketModal">
            <i class="fas fa-plus-circle"></i>
            Nuevo Ticket
        </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-cogs"></i>
            </div>
            <div class="stat-content">
                <h3>{{ estados.progreso }}</h3>
                <p>En Progeso</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <h3>{{ estados.pendiente_cliente }}</h3>
                <p>Pendiente cliente</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="stat-content">
                <h3>{{ estados.pendiente_tercero }}</h3>
                <p>Pendiente de tercero</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <h3>{{ estados.pendiente_aprovacion }}</h3>
                <p>Pendiente de aprovación</p>
            </div>
        </div>
    </div>

    <!-- Tickets Section -->
    <div class="tickets-section">
        <div class="section-header">
            <h2>Todos mis Tickets</h2>
            <div class="filter-options">
                <button class="filter-btn">
                    <i class="fas fa-filter"></i>
                    Filtrar
                </button>
                <button class="filter-btn">
                    <i class="fas fa-sort"></i>
                    Ordenar
                </button>
            </div>
        </div>

        <!-- Tickets List -->
        <div class="tickets-grid">
            {% for ticket in ticktes %}
            <div class="ticket-card">
                <div class="ticket-header">
                    <span class="status-badge status-{{ ticket.estado|lower|replace(' ', '-') }}">
                        {{ ticket.estado }}
                    </span>
                    <span class="priority-badge priority-{{ ticket.prioridad|lower }}">
                        {{ ticket.prioridad }}
                    </span>
                </div>
                <div class="ticket-content">
                    <h3>{{ ticket.titulo }}</h3>
                    <p>{{ ticket.descripcion }}</p>
                </div>
                <div class="ticket-footer">
                    <div class="ticket-info">


                        <span class="ticket-id">Tecnico: {% if ticket.tecnico_id %} #TECNICO-{{ticket.tecnico_id}}

                            {% else %}
                            Sin Asignar

                            {% endif %} </span>



                        <span class="ticket-id">#TICKET-{{ ticket.id }}</span>
                        <span class="ticket-date">{{ ticket.date_created }}</span>
                    </div>
                    <button class="delete-ticket-btn" title="Eliminar ticket" data-bs-toggle="modal"
                        data-bs-target="#deleteTicketModal" data-ticket-id="{{ ticket.id }}"
                        data-ticket-title="{{ ticket.titulo }}">
                        <i class="fas fa-trash-alt"></i>
                    </button>

                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button class="pagination-btn disabled">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="pagination-btn active">1</button>
            <button class="pagination-btn">2</button>
            <button class="pagination-btn">3</button>
            <button class="pagination-btn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- New Ticket Modal -->
<div class="modal fade modern-modal" id="newTicketModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-plus-circle"></i>
                    <h3>Nuevo Ticket de Soporte</h3>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="/crear_ticket" class="ticket-form">
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Asunto *</label>
                            <input type="text" class="form-input" placeholder="Ej: Problema con conexión" name="titulo"
                                required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descripción detallada *</label>
                        <textarea class="form-textarea" rows="5" placeholder="Describe el problema en detalle..."
                            name="descripcion" required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Enviar Ticket
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Delete Ticket Confirmation Modal -->
<div class="modal fade" id="deleteTicketModal" tabindex="-1" aria-labelledby="deleteTicketModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteTicketModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirmar Eliminación
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-trash-alt text-danger" style="font-size: 3rem;"></i>
                </div>
                <p class="text-center">¿Estás seguro de que deseas eliminar el siguiente ticket?</p>
                <h6 class="text-center ticket-title-confirm" id="ticketTitleConfirm"></h6>
                <div class="alert alert-warning mt-3" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Esta acción no se puede deshacer. Todos los datos del ticket se perderán permanentemente.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <form id="deleteTicketForm" method="post" action="/eliminar-ticket">
                    <input type="hidden" name="ticket_id" id="ticketIdInput">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt me-2"></i>Eliminar Ticket
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/tickets.js') }}"></script>
{% endblock %}